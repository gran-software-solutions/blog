<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Why you should design your REST APIs with concurrency in mind | GRAN Software Solutions Blog</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://blog.gransoftware.de/2023/03/27/concurrency-in-rest-apis"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Why you should design your REST APIs with concurrency in mind | GRAN Software Solutions Blog"><meta data-rh="true" name="description" content="Rails"><meta data-rh="true" property="og:description" content="Rails"><meta data-rh="true" property="og:image" content="https://cdn.pixabay.com/photo/2020/05/30/08/17/rails-5238078_960_720.jpg"><meta data-rh="true" name="twitter:image" content="https://cdn.pixabay.com/photo/2020/05/30/08/17/rails-5238078_960_720.jpg"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2023-03-27T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/dodalovicgran"><meta data-rh="true" property="article:tag" content="REST API"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://blog.gransoftware.de/2023/03/27/concurrency-in-rest-apis"><link data-rh="true" rel="alternate" href="https://blog.gransoftware.de/2023/03/27/concurrency-in-rest-apis" hreflang="en"><link data-rh="true" rel="alternate" href="https://blog.gransoftware.de/2023/03/27/concurrency-in-rest-apis" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="GRAN Software Solutions Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="GRAN Software Solutions Blog Atom Feed">






<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@200;300;400;500;600;700&display=swap"><link rel="stylesheet" href="/assets/css/styles.c822315c.css">
<link rel="preload" href="/assets/js/runtime~main.39596c45.js" as="script">
<link rel="preload" href="/assets/js/main.838bec21.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/Logo_BrightOrange.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/Logo_BrightOrange.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">GRAN Blog</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/gran-software-solutions/blog" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2024/01/05/3-important-reasons-why-i-made-my-own-tracking-tool">3 Important Reasons Why I Made My Own Tracking Tool</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2023/05/24/hateoas-hands-on-backend-frontend">HATEOAS Hands-on for Backend and Frontend</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2023/05/16/gzip-compression-guide-vertx-rest-api">To Gzip or Not to Gzip? A Guide to Using Compression in Vert.x REST APIs</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/2023/03/27/concurrency-in-rest-apis">Why you should design your REST APIs with concurrency in mind</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2023/03/22/what-is-technical-debt">What Is Technical Debt?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2023/01/18/what-is-unit-testing">What is Unit testing</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2023/01/17/automotive-industry-digitalization">Yes, companies in the automobile industry can (and should) undergo a digital transformation</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2023/01/15/poc-and-mvp-what-is-the-difference">POC and MVP - What Is The Difference</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2023/01/11/25-software-development-buzzwords-in-simple-terms">25 Software Development Buzzwords Explained In Simple Terms</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2023/01/10/3-big-risks-in-software-projects-and-how-to-avoid-them">3 Big Risks In Software Projects And How To Avoid Them</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="image" content="https://cdn.pixabay.com/photo/2020/05/30/08/17/rails-5238078_960_720.jpg"><header><h1 class="title_f1Hy" itemprop="headline">Why you should design your REST APIs with concurrency in mind</h1><div class="container_mt6G margin-vert--md"><time datetime="2023-03-27T00:00:00.000Z" itemprop="datePublished">March 27, 2023</time> Â· <!-- -->7 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/dodalovicgran" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/dodalovicgran.png" alt="Dusan Odalovic"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/dodalovicgran" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Dusan Odalovic</span></a></div><small class="avatar__subtitle" itemprop="description">Senior engineer @ GRAN Software Solutions GmbH</small></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><figure><p><img loading="lazy" alt="Rails" src="/assets/images/rails-eb1f8d6c01ad6dcbf828de21db10d611.jpg" width="1280" height="853" class="img_ev3q"></p><figcaption><center>Image by <a href="https://pixabay.com/users/furbymama-5146222/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=5238078" target="_blank" rel="noopener noreferrer">Andy M.</a> from <a href="https://pixabay.com//?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=5238078" target="_blank" rel="noopener noreferrer">Pixabay</a></center></figcaption></figure><p>In this article, we will show you how to design and implement a REST API that can handle concurrent requests when updating the same resource.</p><p>We also provided <u><a href="#sample-code">a sample code</a></u> that demonstrates how to implement this in a real-world-like scenario of Wiki page
management API.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="whats-the-problem-to-solve">What&#x27;s the problem to solve?<a href="#whats-the-problem-to-solve" class="hash-link" aria-label="Direct link to What&#x27;s the problem to solve?" title="Direct link to What&#x27;s the problem to solve?">â</a></h2><p>The issue we want to tackle is known as <strong>&quot;lost updates&quot;</strong>. When do such updates happen? When the same resources are attempted to be updated by multiple clients at the same time.
What happens in such cases, if you don&#x27;t have any special handling? <strong>The last update wins</strong>.</p><p>Let&#x27;s illustrate this with an example of two different users trying to update the same Wiki article:</p><br><br><p>The issue with this flow is that the User2 was able to update the document, without even caring if the document might have
changed in the meantime. User1&#x27;s update <strong>was lost</strong>.</p><p>The solution is to make one of the two users (User2 in this case) angry ð.</p><p>How&#x27;s that? Let&#x27;s read on.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="optimistic-locking---the-solution-to-lost-updates">Optimistic locking - the solution to &quot;lost updates&quot;<a href="#optimistic-locking---the-solution-to-lost-updates" class="hash-link" aria-label="Direct link to Optimistic locking - the solution to &quot;lost updates&quot;" title="Direct link to Optimistic locking - the solution to &quot;lost updates&quot;">â</a></h2><p>You may have noticed that some software you used in the past had a mechanism to prevent &quot;lost updates&quot;. Let&#x27;s take a Wiki as an example.
As a Wiki page is shared among your teammates, and as writing a Wiki page is a collaborative effort, and additionally takes a while to write,
the chances are that someone else may have updated the page as of the time you were writing your changes.</p><p>Usually such tools will let you know that you need to sync your changes with the latest version of the page. This may lead to conflicts that
you need to resolve, before saving your work.</p><p>You may have expereinced the same by using Git Source Code Versioning tool. If you try to push your changes to a remote repository, and someone
else pushed their changes to the same branch as you, you will get an error message saying that you need to pull the remote changes first.</p><p>The beauty of this design is that it forces you to base your work on the work of others, <strong>whether you like it or not</strong>.</p><p>The design implemented in both cases is called <u><a href="https://en.wikipedia.org/wiki/Optimistic_concurrency_control" target="_blank" rel="noopener noreferrer">&quot;optimistic locking&quot;</a></u>.
Simply put, it&#x27;s an assumption that the transactions will not interfere often, and that there is no need to lock the resources they may change. Instead,
transactions are allowed to change the data, but before they are committed, there is a check to see if the data has been changed in the meantime. Non
locking approach brings a performance benefit.</p><p>Later in this article, we will show an example of the Wiki page management API, and we will use optimistic locking to prevent &quot;lost updates&quot;.</p><p>Technical means we will use to implement optimistic locking are <code>ETag</code> and <code>If-Match</code> HTTP headers.</p><p>Let&#x27;s learn first about ETags first.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-are-etags">What are ETags?<a href="#what-are-etags" class="hash-link" aria-label="Direct link to What are ETags?" title="Direct link to What are ETags?">â</a></h2><p><code>ETag</code> (stands for <strong>E</strong>ntity Tag) is an <u><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/ETag#avoiding_mid-air_collisions" target="_blank" rel="noopener noreferrer">HTTP response header</a></u>. The value of
this header is an opaque identifier assigned by servers to specific versions of resources. If the content of the resource changes, the ETag changes as well.
ETag is used for caching purposes, as well as for concurrency control. An example of an <code>ETag</code> header:</p><div class="language-http codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-http codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token request-line method property">GET</span><span class="token request-line"> </span><span class="token request-line request-target url" style="color:rgb(221, 221, 221)">/api/v1/documents/123</span><span class="token request-line"> </span><span class="token request-line http-version property">HTTP/1.1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token header header-name keyword" style="font-style:italic">Host</span><span class="token header punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token header"> </span><span class="token header header-value">example.com</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token header header-name keyword" style="font-style:italic">Accept</span><span class="token header punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token header"> </span><span class="token header header-value">application/json</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token response-status http-version property">HTTP/1.1</span><span class="token response-status"> </span><span class="token response-status status-code number" style="color:rgb(247, 140, 108)">200</span><span class="token response-status"> </span><span class="token response-status reason-phrase string" style="color:rgb(195, 232, 141)">OK</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token header header-name keyword" style="font-style:italic">Content-Type</span><span class="token header punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token header"> </span><span class="token header header-value">application/json</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token header header-name keyword" style="font-style:italic">ETag</span><span class="token header punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token header"> </span><span class="token header header-value">&quot;bfc13a64729c4290ef5b2c2730249c88ca92d82d&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token application-json"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token application-json"></span><span class="token application-json punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token application-json"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token application-json">  </span><span class="token application-json property">&quot;id&quot;</span><span class="token application-json operator" style="color:rgb(137, 221, 255)">:</span><span class="token application-json"> </span><span class="token application-json number" style="color:rgb(247, 140, 108)">123</span><span class="token application-json punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token application-json"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token application-json">  </span><span class="token application-json property">&quot;title&quot;</span><span class="token application-json operator" style="color:rgb(137, 221, 255)">:</span><span class="token application-json"> </span><span class="token application-json string" style="color:rgb(195, 232, 141)">&quot;My document&quot;</span><span class="token application-json punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token application-json"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token application-json">  </span><span class="token application-json property">&quot;content&quot;</span><span class="token application-json operator" style="color:rgb(137, 221, 255)">:</span><span class="token application-json"> </span><span class="token application-json string" style="color:rgb(195, 232, 141)">&quot;This is my document&quot;</span><span class="token application-json"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token application-json"></span><span class="token application-json punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>There are 2 types of <code>ETag</code>s: <strong>weak</strong> and <strong>strong</strong>.
Strong <code>ETag</code>s imply byte-by-byte equality. Weak <code>ETag</code>s imply semantic equality.</p><p>Technically, weak <code>ETag</code>s are prefixed with <code>W/</code>. Strong <code>ETag</code>s are not prefixed.</p><p>An example of a weak <code>ETag</code> would be <code>W/&quot;bakck3&quot;</code>, whereas an example of a strong <code>ETag</code> would be <code>&quot;bfc13a64729c4290ef5b2c2730249c88ca92d82d&quot;</code>.</p><p>Strong <code>ETag</code>s are usually preferred, as they are more reliable. However, they are more expensive to compute
As strong <code>ETag</code>s are preferred by <code>If-Match</code> header, we will use them in our example.</p><p>Read more about <code>ETag</code>s in <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/ETag" target="_blank" rel="noopener noreferrer">MDN Web Docs</a>.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="control-concurrency-with-if-match-http-request-header">Control concurrency with <code>If-Match</code> HTTP request header<a href="#control-concurrency-with-if-match-http-request-header" class="hash-link" aria-label="Direct link to control-concurrency-with-if-match-http-request-header" title="Direct link to control-concurrency-with-if-match-http-request-header">â</a></h2><p><code>If-Match</code> <u><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/If-Match" target="_blank" rel="noopener noreferrer">request header</a></u> makes the request conditional.
<code>If-Match</code> contains list of <code>ETag</code>s. The flow works like this:</p><ol><li>A user requests a resource from the server, and the server responds with the resource and its <code>ETag</code>.</li><li>User makes local modification to the resource</li><li>User sends the modified resource to the server, along with the <code>ETag</code> of the resource it received from the server. This <code>ETag</code> is sent in
<code>If-Match</code> header.</li><li>Server checks if the <code>ETag</code> in <code>If-Match</code> header matches the <code>ETag</code> of the resource on the server. If they match, the server proceeds with
handling the request.</li><li>If the <code>ETag</code>s don&#x27;t match, the server responds with <code>412 Precondition Failed</code> response.</li></ol><p>Let&#x27;s illustrate this with an example based on our Wiki page management API:</p><br><h2 class="anchor anchorWithStickyNavbar_LWe7" id="real-world-example">Real-world example<a href="#real-world-example" class="hash-link" aria-label="Direct link to Real-world example" title="Direct link to Real-world example">â</a></h2><p>As mentioned earlier, we designed the Wiki page management API. It provides the following user experience:</p><p><img loading="lazy" alt="Action sequence" src="/assets/images/action-sequence-6613a97b77df80415b326523ac0095eb.png" width="3046" height="2236" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="design--implementation">Design &amp; Implementation<a href="#design--implementation" class="hash-link" aria-label="Direct link to Design &amp; Implementation" title="Direct link to Design &amp; Implementation">â</a></h2><p>To be able to achieve such a user experience, we came up with the following API design:</p><ul><li>We will need 2 API operations, one to <strong>save</strong> and one to <strong>get</strong> a Wiki page</li><li>We will use <strong>strong ETags</strong> and <strong>If-Match</strong> HTTP headers</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="saving-a-wiki-page">Saving a Wiki page<a href="#saving-a-wiki-page" class="hash-link" aria-label="Direct link to Saving a Wiki page" title="Direct link to Saving a Wiki page">â</a></h3><p>We designed saving a Wiki page so that it will use an idempotent <code>PUT</code> HTTP method. This method will be used to create a new document,
as well as to update an existing one. Clients are allowed to set the <code>id</code> of a Wiki page.</p><p>The following is a flowchart of how the API operation was implemented:</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>The algorithm above strictly follows the <a href="https://www.rfc-editor.org/rfc/rfc7232#section-5" target="_blank" rel="noopener noreferrer">RFC 7232</a> specification.</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="getting-a-wiki-page">Getting a Wiki page<a href="#getting-a-wiki-page" class="hash-link" aria-label="Direct link to Getting a Wiki page" title="Direct link to Getting a Wiki page">â</a></h3><p>Getting a Wiki page is far simpler. Using standard <code>GET</code> HTTP method, we will return the Wiki page with the provided <code>wikiId</code>.
If there&#x27;s no such page with the provided <code>wikiId</code>, we will return <code>404 Not Found</code>.</p><p>The following is a flowchart of how the API operation was implemented:</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="sample-code">Sample code<a href="#sample-code" class="hash-link" aria-label="Direct link to Sample code" title="Direct link to Sample code">â</a></h2><p>On our GitHub, we&#x27;ve published <u><a href="https://github.com/gran-software-solutions/code-samples/tree/main/concurrency-in-rest-apis" target="_blank" rel="noopener noreferrer">a sample project</a></u> that implements the described API.
The sample code is written in <u><a href="https://kotlinlang.org/" target="_blank" rel="noopener noreferrer">Kotlin</a></u> using <u><a href="https://vertx.io/" target="_blank" rel="noopener noreferrer">Vert.x</a></u> toolkit. It requires having <u><a href="https://adoptopenjdk.net/" target="_blank" rel="noopener noreferrer">JDK 11</a></u> or newer installed</p><p>The code contains a README file, with instructions on how to <u><a href="https://github.com/gran-software-solutions/code-samples/tree/main/concurrency-in-rest-apis#running-application" target="_blank" rel="noopener noreferrer">run the app</a></u> and how to <u><a href="https://github.com/gran-software-solutions/code-samples/tree/main/concurrency-in-rest-apis#how-to-interact-with-the-running-application" target="_blank" rel="noopener noreferrer">interact with it</a></u></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-now">What now?<a href="#what-now" class="hash-link" aria-label="Direct link to What now?" title="Direct link to What now?">â</a></h2><p>Are there use-cases where your API consumers can manage the same resource? To avoid data loss, use optimistic locking.</p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/rest-api">REST API</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/gran-software-solutions/blog/tree/main/blog/2023-03-27-concurrency-in-rest-apis/index.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/2023/05/16/gzip-compression-guide-vertx-rest-api"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">To Gzip or Not to Gzip? A Guide to Using Compression in Vert.x REST APIs</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/2023/03/22/what-is-technical-debt"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">What Is Technical Debt?</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#whats-the-problem-to-solve" class="table-of-contents__link toc-highlight">What&#39;s the problem to solve?</a></li><li><a href="#optimistic-locking---the-solution-to-lost-updates" class="table-of-contents__link toc-highlight">Optimistic locking - the solution to &quot;lost updates&quot;</a></li><li><a href="#what-are-etags" class="table-of-contents__link toc-highlight">What are ETags?</a></li><li><a href="#control-concurrency-with-if-match-http-request-header" class="table-of-contents__link toc-highlight">Control concurrency with <code>If-Match</code> HTTP request header</a></li><li><a href="#real-world-example" class="table-of-contents__link toc-highlight">Real-world example</a></li><li><a href="#design--implementation" class="table-of-contents__link toc-highlight">Design &amp; Implementation</a><ul><li><a href="#saving-a-wiki-page" class="table-of-contents__link toc-highlight">Saving a Wiki page</a></li><li><a href="#getting-a-wiki-page" class="table-of-contents__link toc-highlight">Getting a Wiki page</a></li></ul></li><li><a href="#sample-code" class="table-of-contents__link toc-highlight">Sample code</a></li><li><a href="#what-now" class="table-of-contents__link toc-highlight">What now?</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">GRAN</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.gransoftware.de" target="_blank" rel="noopener noreferrer" class="footer__link-item">Website</a></li><li class="footer__item"><a href="https://www.linkedin.com/company/gran-software-solutions/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn</a></li><li class="footer__item"><a href="https://discord.gg/2uYKcWG9" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://timeline.gransoftware.de" target="_blank" rel="noopener noreferrer" class="footer__link-item">Time Tracking Tool</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item">
                                    <a href="https://gransoftware.de" target="_blank">
                                      <img class="footer-logo" alt="GRAN Software Solutions GmbH" src="/img/Logotype_Tagline_BrightOrange.png">
                                    </a>
                                  </li><li class="footer__item"><a href="https://github.com/gran-software-solutions/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/credits">Credits</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2024 GRAN Software Solutions GmbH. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.39596c45.js"></script>
<script src="/assets/js/main.838bec21.js"></script>
</body>
</html>